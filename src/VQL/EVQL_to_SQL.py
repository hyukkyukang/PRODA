import json
import argparse

from src.VQL.EVQL import EVQLTree

def parse_args():
    parser = argparse.ArgumentParser(description="Translate EVQL to SQL")
    parser.add_argument(
        "--evql_in_json_str",
        type=str,
        help="dumped EVQL in json format",
    )
    return parser.parse_args()


if __name__ == "__main__":
    # Parse arguments
    args = parse_args()
    evql_in_json = json.loads(args.evql_in_json_str)
    # evql_in_json =json.loads('{"node":{"name":"cars2_query","table_excerpt":{"name":"cars2","headers":["id","model","horsepower","max_speed","year","price","g_model","avg_max_speed"],"col_types":["DNumber","DString","DNumber","DNumber","DNumber","DNumber","DList.DString","DList.DNumber"],"rows":[{"cells":[{"value":1},{"value":"ford"},{"value":10},{"value":230},{"value":2010},{"value":20000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":2},{"value":"cherlet"},{"value":10},{"value":330},{"value":2010},{"value":15000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":3},{"value":"toyota"},{"value":10},{"value":430},{"value":2011},{"value":10000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":4},{"value":"volkswage"},{"value":10},{"value":530},{"value":2011},{"value":8000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":5},{"value":"amc"},{"value":10},{"value":630},{"value":2012},{"value":15000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":6},{"value":"pontiac"},{"value":10},{"value":730},{"value":2012},{"value":71000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":7},{"value":"datsun"},{"value":10},{"value":830},{"value":2013},{"value":81000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":8},{"value":"hyundai"},{"value":10},{"value":930},{"value":2013},{"value":91000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":9},{"value":"hyundai"},{"value":11},{"value":940},{"value":2014},{"value":92000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":10},{"value":"kia"},{"value":10},{"value":1030},{"value":2014},{"value":101000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":11},{"value":"genesis"},{"value":10},{"value":1130},{"value":2014},{"value":111000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]},{"cells":[{"value":12},{"value":"genesis"},{"value":11},{"value":1140},{"value":2015},{"value":112000},{"value":["ford","cherlet","toyota","volkswage","amc","pontiac","datsun","hyundai","kia","genesis"]},{"value":[230,330,430,530,630,730,830,935,1030,1135]}]}],"base_table_names":["cars","cars","cars","cars","cars","cars","cars_query","cars_query"]},"projection":{"headers":[{"id":1,"agg_type":null}]},"predicate":{"clauses":[{"conditions":[{"header_id":4,"func_type":"Selecting","op_type":3,"r_operand":"$8"},{"header_id":2,"func_type":"Selecting","op_type":1,"r_operand":"$7"}]}]},"headers":["cars2","id","model","horsepower","max_speed","year","price","g_model","avg_max_speed"]},"children":[{"node":{"name":"cars_query","table_excerpt":{"name":"cars","headers":["id","model","horsepower","max_speed","year","price"],"col_types":["DNumber","DString","DNumber","DNumber","DNumber","DNumber"],"rows":[{"cells":[{"value":1},{"value":"ford"},{"value":10},{"value":230},{"value":2010},{"value":20000}]},{"cells":[{"value":2},{"value":"cherlet"},{"value":10},{"value":330},{"value":2010},{"value":15000}]},{"cells":[{"value":3},{"value":"toyota"},{"value":10},{"value":430},{"value":2011},{"value":10000}]},{"cells":[{"value":4},{"value":"volkswage"},{"value":10},{"value":530},{"value":2011},{"value":8000}]},{"cells":[{"value":5},{"value":"amc"},{"value":10},{"value":630},{"value":2012},{"value":15000}]},{"cells":[{"value":6},{"value":"pontiac"},{"value":10},{"value":730},{"value":2012},{"value":71000}]},{"cells":[{"value":7},{"value":"datsun"},{"value":10},{"value":830},{"value":2013},{"value":81000}]},{"cells":[{"value":8},{"value":"hyundai"},{"value":10},{"value":930},{"value":2013},{"value":91000}]},{"cells":[{"value":9},{"value":"hyundai"},{"value":11},{"value":940},{"value":2014},{"value":92000}]},{"cells":[{"value":10},{"value":"kia"},{"value":10},{"value":1030},{"value":2014},{"value":101000}]},{"cells":[{"value":11},{"value":"genesis"},{"value":10},{"value":1130},{"value":2014},{"value":111000}]},{"cells":[{"value":12},{"value":"genesis"},{"value":11},{"value":1140},{"value":2015},{"value":112000}]}],"base_table_names":["cars","cars","cars","cars","cars","cars"]},"projection":{"headers":[{"id":4,"agg_type":3}]},"predicate":{"clauses":[{"conditions":[{"header_id":2,"func_type":"Grouping"}]}]},"headers":["cars","id","model","horsepower","max_speed","year","price"]},"children":[]}]}')
    evql_tree = EVQLTree.load_json(evql_in_json)
    print(f"{evql_tree.to_sql}")
